<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/willbe/blog/rss.xml" title="WELCOME Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/willbe/blog/atom.xml" title="WELCOME Blog Atom Feed">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/katex.min.css"><title data-react-helmet="true">AWS를 활용한 인공지능 모델 배포 | WELCOME</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="AWS를 활용한 인공지능 모델 배포 | WELCOME"><meta data-react-helmet="true" name="description" content="💡 『KDT 프로그래머스 인공지능 데브코스』에서 공부중..👀"><meta data-react-helmet="true" property="og:description" content="💡 『KDT 프로그래머스 인공지능 데브코스』에서 공부중..👀"><meta data-react-helmet="true" property="og:url" content="https://heeju0.github.io/willbe/docs/kdt/web/aws1"><link data-react-helmet="true" rel="shortcut icon" href="/willbe/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://heeju0.github.io/willbe/docs/kdt/web/aws1"><link rel="stylesheet" href="/willbe/styles.28bf0270.css">
<link rel="preload" href="/willbe/styles.2c3dfb8e.js" as="script">
<link rel="preload" href="/willbe/runtime~main.8bbf9e40.js" as="script">
<link rel="preload" href="/willbe/main.d215830a.js" as="script">
<link rel="preload" href="/willbe/1.95d38675.js" as="script">
<link rel="preload" href="/willbe/2.1bb1b4fc.js" as="script">
<link rel="preload" href="/willbe/1be78505.23bb998b.js" as="script">
<link rel="preload" href="/willbe/104.1ff1ac5b.js" as="script">
<link rel="preload" href="/willbe/f976f453.087a1e6b.js" as="script">
<link rel="preload" href="/willbe/103.9c5787d0.js" as="script">
<link rel="preload" href="/willbe/616f799a.bde1250b.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top navbarHideable_17Wu navbarHidden_19ww"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/willbe/"><img src="/willbe/img/android-chrome-512x512.png" alt="My Site" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/willbe/img/android-chrome-512x512.png" alt="My Site" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">WILL BE</strong></a><a class="navbar__item navbar__link" href="/willbe/docs/guides">Docs</a><a class="navbar__item navbar__link" href="/willbe/docs/data-science/how-to">Data Science</a><a class="navbar__item navbar__link navbar__link--active" href="/willbe/docs/kdt/data_structures/definition">KDT AI/ML</a><a class="navbar__item navbar__link" href="/willbe/docs/coding-practice/greedy">Coding</a><a class="navbar__item navbar__link" href="/willbe/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/heeju0/willbe" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/willbe/"><img src="/willbe/img/android-chrome-512x512.png" alt="My Site" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/willbe/img/android-chrome-512x512.png" alt="My Site" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">WILL BE</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/willbe/docs/guides">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/willbe/docs/data-science/how-to">Data Science</a></li><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/willbe/docs/kdt/data_structures/definition">KDT AI/ML</a></li><li class="menu__list-item"><a class="menu__link" href="/willbe/docs/coding-practice/greedy">Coding</a></li><li class="menu__list-item"><a class="menu__link" href="/willbe/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/heeju0/willbe" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link" aria-label="GitHub repository">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy sidebarWithHideableNavbar_CROi"><a tabindex="-1" class="sidebarLogo_xFc8" href="/willbe/"><img src="/willbe/img/android-chrome-512x512.png" alt="My Site" class="themedImage_YANc themedImage--light_3CMI"><img src="/willbe/img/android-chrome-512x512.png" alt="My Site" class="themedImage_YANc themedImage--dark_3ARp"><strong>WILL BE</strong></a><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">파이썬 프로그래밍 기초</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/willbe/docs/kdt/data_structures/definition">정의</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/willbe/docs/kdt/data_structures/data_structures1">자료구조 기초</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/willbe/docs/kdt/data_structures/data_structures2">연결 리스트</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/willbe/docs/kdt/data_structures/data_structures3">스택</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/willbe/docs/kdt/data_structures/data_structures4">큐</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/willbe/docs/kdt/data_structures/data_structures5">트리</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/willbe/docs/kdt/data_structures/data_structures6">힙</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/willbe/docs/kdt/data_structures/data_structures7">해시</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/willbe/docs/kdt/data_structures/data_structures8">탐욕법</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/willbe/docs/kdt/data_structures/data_structures9">정렬</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/willbe/docs/kdt/data_structures/data_structures10">동적계획법</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/willbe/docs/kdt/data_structures/exercise">연습문제</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">인공지능 수학</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/willbe/docs/kdt/math/math1">선형대수</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/willbe/docs/kdt/math/math2">통계학</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Git</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/willbe/docs/kdt/python/git">Git</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">파이썬으로 데이터 다루기</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/willbe/docs/kdt/python/python1">Numpy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/willbe/docs/kdt/python/python2">Pandas</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/willbe/docs/kdt/python/python3">Matplotlib</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/willbe/docs/kdt/python/python4">Seaborn</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/willbe/docs/kdt/python/python5">EDA</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">파이썬으로 웹 다루기</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/willbe/docs/kdt/web/flask1">Flask</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/willbe/docs/kdt/web/aws1">AWS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/willbe/docs/kdt/web/django1">Django</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">머신러닝</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/willbe/docs/kdt/ml/ml1">Machine Learning 기초 (미완성)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/willbe/docs/kdt/ml/ml2">E2E (미완성)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/willbe/docs/kdt/ml/ml3">Linear Algebra (미완성)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/willbe/docs/kdt/ml/ml4">Matrix Caculus (미완성)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/willbe/docs/kdt/ml/ml5">Probability Distributions (미완성)</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">AWS를 활용한 인공지능 모델 배포</h1></header><div class="markdown"><p>💡 『KDT 프로그래머스 인공지능 데브코스』에서 공부중..👀  </p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span><strong>우리의 목표</strong>  </h5></div><div class="admonition-content"><p>클라우드 환경에서 학습한 AI 모델을 서빙하기 위한 API를 개발한다.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="1-클라우드-기초"></a>1. 클라우드 기초<a class="hash-link" href="#1-클라우드-기초" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="클라우드-컴퓨팅-등장-이전"></a>클라우드 컴퓨팅 등장 이전<a class="hash-link" href="#클라우드-컴퓨팅-등장-이전" title="Direct link to heading">#</a></h3><p>과거에는 인터넷 환경에서 서비스를 제공하기 위해 서비스 호스팅에 필요한 모든 것을 서비스 제공자가 직접 구축해야 했다.<br>
- 데이터 센터(물리적 공간), 서버, 저장소, 네트워크 방화벽 및 보안, 운영체제·개발도구, 전기·온도·습도 관리, 운영/관리 인력 등</p><p>모든 것을 직접 관리해야 하는 환경을 개선하기 위해 IDC가 등장했다.<br>
IDC(Internet Data Center)는 서버 운영에 필요한 공간, 네트워크, 유지 보수 등의 서비스를 제공하며, IDC 입주자가 직접 서버를 구입하여 들어오기도 하지만 IDC에서 서버를 임대해주기도 한다.  </p><p>그러나 IDC 또한 계약을 통해 일정 기간동안 임대를 하는 구조이기 때문에 유연성이 떨어진다.  </p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="클라우드-컴퓨팅-등장-배경"></a>클라우드 컴퓨팅 등장 배경<a class="hash-link" href="#클라우드-컴퓨팅-등장-배경" title="Direct link to heading">#</a></h3><p>인터넷 사용자가 크게 증가하고 다양한 서비스를 제공하게 되면서 필요한 때에 원하는 만큼의 서버를 증설하고자 하는 온디멘드의 수요가 증가하였고, 이에 효율성 극대화를 추구하게 되었다.</p><p>- 사용자 접속량이 늘어나 컴퓨팅 수요가 증가할 때에는 오토 스케일링이 필요<br>
- 자주 사용되지 않는 유휴 자원은 비용에서 제외<br>
- 필요한 시점에 바로 사용할 수 있도록 필요한 소프트웨어는 미리 설치<br>
와 같은 요청이 늘어남  </p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="클라우드-컴퓨팅-cloud-computing"></a>클라우드 컴퓨팅 (Cloud Computing)<a class="hash-link" href="#클라우드-컴퓨팅-cloud-computing" title="Direct link to heading">#</a></h3><p>= Cloud<br>
인터넷 기반 컴퓨팅의 일종으로, 언제 어디서나 필요한 만큼의 컴퓨팅 자원을 필요한 시간만큼 인터넷을 통하여 활용할 수 있는 컴퓨팅 방식이다. 2006년 아마존이 클라우드를 통한 저장공간 및 연산 자원 제공 서비스인 S3와 EC2를 개시하면서 본격적인 클라우드 컴퓨팅 시대가 시작되었다.  </p><p>AWS에서 정의한 클라우드 컴퓨팅:<br>
클라우드 서비스 플랫폼에서 컴퓨팅 파워, DB 저장공간, 애플리케이션 및 기타 IT자원을 필요에 따라 인터넷을 통해 제공하고, 사용한 만큼만 비용을 지불하는 것  </p><p>현재의 4차 산업혁명 시대에서는 빅데이터의 수집, 저장 분석을 위한 방대한 컴퓨팅 자원과 인공지능 모델 개발을 위한 고성능 컴퓨터 연산을 필요로 하며, 이를 IDC를 이용하거나 직접 구축할 경우 매우 큰 비용이 발생하며 불필요한 것까지 구매해야 하는 상황이 생긴다. 클라우드 컴퓨팅을 통해 적은 비용으로 빠르게 필요한 IT 환경을 마련하여 이러한 상황들을 해결할 수 있다.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="클라우드-컴퓨팅의-장점"></a>클라우드 컴퓨팅의 장점<a class="hash-link" href="#클라우드-컴퓨팅의-장점" title="Direct link to heading">#</a></h3><p>속도, 접근성, 확장성, 생산성, 보안 및 안정성, 측정 가능성 등의 장점을 가진다.  </p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="속도"></a>속도<a class="hash-link" href="#속도" title="Direct link to heading">#</a></h4><p>클라우드 제공자와 별도의 커뮤니케이션 없이 원하는 서비스를 바로 이용할 수 있다.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="접근성"></a>접근성<a class="hash-link" href="#접근성" title="Direct link to heading">#</a></h4><p>인터넷을 통해 사용자의 위치, 시간과 관계없이 어떤 디바이스로도 접근이 가능하다.  </p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="확장성"></a>확장성<a class="hash-link" href="#확장성" title="Direct link to heading">#</a></h4><p>갑작스러운 사용량 변화에 신속하고 유연하게 대처할 수 있다.  </p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="생산성"></a>생산성<a class="hash-link" href="#생산성" title="Direct link to heading">#</a></h4><p>하드웨어, 소프트웨어를 설치하는데 필요한 시간과 비용을 절감하여 핵심 업무에 집중할 수 있다.  </p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="보안-및-안정성"></a>보안 및 안정성<a class="hash-link" href="#보안-및-안정성" title="Direct link to heading">#</a></h4><p>클라우드 공급자가 전체적으로 보안 및 안정성애 대해 준비하기 때문에 안정성 측면에서 도움이 된다.  </p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="측정-가능성"></a>측정 가능성<a class="hash-link" href="#측정-가능성" title="Direct link to heading">#</a></h4><p>분이나 초 단위로 측정되기 때문에 사용자가 서비스를 이용한 만큼만 계량하여 결제할 수 있다.  </p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="클라우드-컴퓨팅-운용-모델"></a>클라우드 컴퓨팅 운용 모델<a class="hash-link" href="#클라우드-컴퓨팅-운용-모델" title="Direct link to heading">#</a></h3><p>구축 및 배포 유형에 따라 Public, Private, Hybrid 형태로 구분할 수 있다.  </p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="public-cloud"></a>Public Cloud<a class="hash-link" href="#public-cloud" title="Direct link to heading">#</a></h4><p>개방적인 환경에서 접속하는 흔히 알고 있는 클라우드로, AWS, GCP, Azure와 같은 외부 클라우드 컴퓨팅 사업자가 IT자원을 소유하고 인터넷을 통해 제공하는 형태  </p><p>IT관리 인력이나 인프라 구축 비용이 없는 경우에 유용하다.  </p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="private-cloud"></a>Private Cloud<a class="hash-link" href="#private-cloud" title="Direct link to heading">#</a></h4><p>고객이 자체 데이터센터에서 직접 클라우드 서비스를 구축하는 형태로, 내부 계열사나 고객에게만 제공하기 때문에 인프라 확충은 쉬우나 IT기술 확보가 어렵다.  </p><p>보안이 좋고 커스터마이제이션이 가능하며, 글로벌 클라우드 사업자가 IT기술만 패키지 형태로 판매하기도 한다.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="hybrid-cloud"></a>Hybrid Cloud<a class="hash-link" href="#hybrid-cloud" title="Direct link to heading">#</a></h4><p>고객의 핵심은 내부에 두면서도 외부의 클라우드를 활용하는 형태  </p><p>IT기술은 클라우드로부터 받고, 서비스 유지를 위한 인프라는 고객의 것을 혼용하며 public의 경제성과 privit의 보안성을 모두 고려한다.  </p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="클라우드-서비스-제공-모델"></a>클라우드 서비스 제공 모델<a class="hash-link" href="#클라우드-서비스-제공-모델" title="Direct link to heading">#</a></h3><p>클라우드 서비스 제공 방식에 따라 IaaS, PaaS, SaaS로 구분한다.  </p><p>ㅤㅤ<img alt="func" src="/willbe/assets/images/aws1-447f41878f00c28eeddbcc92193c62f4.jpg">  </p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="on-premises"></a>On-Premises<a class="hash-link" href="#on-premises" title="Direct link to heading">#</a></h4><p>전부 직접 구축하고 관리하는 형태  </p><ul><li>You Manage: Applications, Data, Runtime, Middleware, OS, Virtualization, Servers, Storage, Networking  </li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="iaas-infra-as-a-service"></a>IaaS (Infra as a Service)<a class="hash-link" href="#iaas-infra-as-a-service" title="Direct link to heading">#</a></h4><p>(이아스 라고 읽음)<br>
인프라적인 측면은 클라우드에서 사용하고 나머지는 직접 관리하는 형태  </p><ul><li>You Manage: Applications, Data, Runtime, Middleware, OS  </li><li>Delivered as a Service: Virtualization, Servers, Storage, Networking  </li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="paas-platform-as-a-service"></a>PaaS (Platform as a Service)<a class="hash-link" href="#paas-platform-as-a-service" title="Direct link to heading">#</a></h4><p>인프라 + 플랫폼적인 측면까지 클라우드로부터 제공받는 형태  </p><ul><li>You Manage: Applications, Data  </li><li>Delivered as a Service: Runtime, Middleware, OS, Virtualization, Servers, Storage, Networking  </li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="saas-software-as-a-service"></a>SaaS (Software as a Service)<a class="hash-link" href="#saas-software-as-a-service" title="Direct link to heading">#</a></h4><p>하드웨어나 OS와 같은 영역뿐만 아니라 소프트웨어까지 클라우드로부터 제공받는 형태  </p><ul><li>Delivered as a Service: Runtime, Middleware, OS, Virtualization, Servers, Storage, Networking  </li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="서비스-제공-모델을-피자를-먹는-것과-비교"></a>서비스 제공 모델을 피자를 먹는 것과 비교<a class="hash-link" href="#서비스-제공-모델을-피자를-먹는-것과-비교" title="Direct link to heading">#</a></h4><p>ㅤㅤ<img alt="func" src="/willbe/assets/images/aws2-8f6bcbf2715260a2a8f0382508f9e639.jpg">  </p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="aws-cloud-computing"></a>AWS Cloud Computing<a class="hash-link" href="#aws-cloud-computing" title="Direct link to heading">#</a></h3><p>인프라와 기초 서비스뿐만 아니라 사용자 니즈에 맞는 다양한 애플리케이션을 제공한다. 이 중에서 우리는 EC2를 사용한다.  </p><p>ㅤㅤ<img alt="func" src="/willbe/assets/images/aws3-ac9fd197d13f59fe68503475e7055531.jpg">  </p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="2-실습-aws--실습-환경-세팅"></a>2. 실습: AWS &amp; 실습 환경 세팅<a class="hash-link" href="#2-실습-aws--실습-환경-세팅" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="aws-계정-가입"></a>AWS 계정 가입<a class="hash-link" href="#aws-계정-가입" title="Direct link to heading">#</a></h3><p><a href="https://aws.amazon.com/ko/" target="_blank" rel="noopener noreferrer">https://aws.amazon.com/ko/</a> 접속 후 회원가입 진행<br>
해외결제 가능한 카드 결제를 등록해야 회원가입이 가능하며, 신규 회원은 프리티어 서비스에 한해 12개월 무료로 사용 가능하다.  </p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="ec2-생성--security-group-설정"></a>EC2 생성 &amp; Security Group 설정<a class="hash-link" href="#ec2-생성--security-group-설정" title="Direct link to heading">#</a></h3><p>AMI 선택 -&gt; 인스턴스 유형 선택 &amp; 보안 그룹 설정 -&gt;  키 페어 생성 &amp; 인스턴스 시작 검토 -&gt; 인스턴스 생성 확인  </p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="i-ami-선택"></a>i) AMI 선택<a class="hash-link" href="#i-ami-선택" title="Direct link to heading">#</a></h4><p>필요로 하는 개발 환경에 따라 이미지들이 미리 빌드되어 있는 AMI(Amazon Machine Image)를 제공한다.  </p><p>AWS 관리 콘솔 -&gt; <code>가상 머신 시작(EC2 사용)</code> -&gt; Deep learning 검색 -&gt; Deep Learning AMI <code>선택</code> </p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="ii-인스턴스-유형-선택--보안-그룹-설정"></a>ii) 인스턴스 유형 선택 &amp; 보안 그룹 설정<a class="hash-link" href="#ii-인스턴스-유형-선택--보안-그룹-설정" title="Direct link to heading">#</a></h4><p>프리티어인 t2.micro 또는 컴퓨팅에 최적화된 가장 저렴한 c5.large 인스턴스 유형을 선택 -&gt; <code>다음: 인스턴스 세부정보 구성</code> -&gt; ⋯ 계속 다음 클릭 -&gt; 단계6: 보안그룹 구성 -&gt; <code>규칙 추가</code> -&gt; 원격으로 API 서버에 접근/호출할 수 있도록 사용자 설정 포트를 새로 생성 (포트범위: 5000, 소스 0.0.0.0/0) -&gt; <code>검토 및 시작</code></p><div class="admonition admonition-warning alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>warning</h5></div><div class="admonition-content"><p>인스턴스 타입에 따라 과금이 발생할 수 있으므로 사용하지 않을 때는 중지하거나 종료해야 한다.</p></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="iii-키-페어-생성--인스턴스-시작-검토"></a>iii) 키 페어 생성 &amp; 인스턴스 시작 검토<a class="hash-link" href="#iii-키-페어-생성--인스턴스-시작-검토" title="Direct link to heading">#</a></h4><p>단계 7: 인스턴스 시작 검토 -&gt; <code>시작하기</code> -&gt; <code>새 키 페어 생성</code> (kdt로 설정) -&gt; <code>키 페어 다운로드</code> -&gt; <code>인스턴스 시작</code>  </p><p>❗ 다운로드한 키 페어는 이후 인스턴스를 접속하기 위해 반드시 필요하다.  </p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="iv-인스턴스-생성-확인"></a>iv) 인스턴스 생성 확인<a class="hash-link" href="#iv-인스턴스-생성-확인" title="Direct link to heading">#</a></h4><p><code>인스턴스 보기</code>를 통해 생성 확인<br>
ㅤㅤ<img alt="func" src="/willbe/assets/images/aws4-d055e0d8e7c92b672105832df1227440.png">  </p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="탄력적-ip-설정"></a>탄력적 IP 설정<a class="hash-link" href="#탄력적-ip-설정" title="Direct link to heading">#</a></h3><p>인스턴스를 중지하거나 종료한 후 다시 시작 및 생성하게 되면 기존 퍼블릭 IP가 변경되며, 퍼블릭 IP를 고정으로 사용하고자 할 때 탄력적 IP 주소를 할당할 수 있으나 추가 과금이 발생한다.  </p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="i-탄력적-ip-생성"></a>i) 탄력적 IP 생성<a class="hash-link" href="#i-탄력적-ip-생성" title="Direct link to heading">#</a></h4><p>왼쪽 사이드바에서 네트워크 및 보안의 <code>탄력적 IP</code> 클릭 -&gt; <code>탄력적 IP 주소 할당</code> -&gt; <code>할당</code></p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="ii-탄력적-ip를-인스턴스에-연결"></a>ii) 탄력적 IP를 인스턴스에 연결<a class="hash-link" href="#ii-탄력적-ip를-인스턴스에-연결" title="Direct link to heading">#</a></h4><p>생성한 탄력적 IP를 인스턴스의 IP 주소로 사용하기 위해 연결한다.  </p><p>할당된 IPv4 주소 아래 주소 값 클릭 -&gt; <code>탄력적 IP 주소 연결</code> -&gt; 인스턴스 선택 후 <code>연결</code>  </p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="iii-연결-확인"></a>iii) 연결 확인<a class="hash-link" href="#iii-연결-확인" title="Direct link to heading">#</a></h4><p>왼쪽 사이드바에서 인스턴스의 <code>인스턴스</code> 클릭 -&gt; 선택한 인스턴스의 퍼블릭 IP와 탄력적 IP가 일치하는 것을 확인  </p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="vs-code로-환경-테스트"></a>VS Code로 환경 테스트<a class="hash-link" href="#vs-code로-환경-테스트" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="i-인스턴스-연결-초기화"></a>i) 인스턴스 연결 초기화<a class="hash-link" href="#i-인스턴스-연결-초기화" title="Direct link to heading">#</a></h4><p>다운로드 받은 키 페어가 있는 위치에서 AWS 가이드에 따라 진행한다.  </p><p>Mac OS, Linux는 자체 터미널로 바로 수행 가능하며, Windows는 OpenSSH 클라이언트 설치 후 CM 또는 PowerShell에서 진행 가능하다.  </p><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="aws-가이드-위치"></a>AWS 가이드 위치<a class="hash-link" href="#aws-가이드-위치" title="Direct link to heading">#</a></h5><p>인스턴스 ID 우클릭 -&gt; <code>연결</code> -&gt; <code>SSH 클라이언트</code>에서 확인</p><h5><a aria-hidden="true" tabindex="-1" class="anchor" id="openssh-설치-및-실행"></a>OpenSSH 설치 및 실행<a class="hash-link" href="#openssh-설치-및-실행" title="Direct link to heading">#</a></h5><p>시작 &gt; 설정 &gt; 앱 &gt; 앱 및 기능에서 <code>선택적 기능</code> 클릭 -&gt; <code>기능 추가</code> -&gt; OpenSSH 서버를 검색하여 설치 -&gt; Git Bash 실행</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cmd codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(57, 58, 52);background-color:#e5ebf7"><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">$ cd [kdt.pem 파일이 저장된 경로]</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">$ chmod 400 kdt.pem</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">$ ssh -i &quot;kdt.pem&quot; ubuntu@ec2-3-36-222-25.ap-northeast-2.compute.amazonaws.com</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>❗ 처음에 Timed Out 오류가 떴었는데 인스턴스 상태 검사가 끝난 뒤에 다시 실행해보니 바로 성공했다..!  </p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="ii-원격-접속-및-개발을-위한-vs-code-플러그인-설치"></a>ii) 원격 접속 및 개발을 위한 VS Code 플러그인 설치<a class="hash-link" href="#ii-원격-접속-및-개발을-위한-vs-code-플러그인-설치" title="Direct link to heading">#</a></h4><p><code>Remote - SSH</code>, <code>Remote Development</code> 설치</p><p>앞으로 실습은 VS Code로 진행한다.  </p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="iii-인스턴스에-접속"></a>iii) 인스턴스에 접속<a class="hash-link" href="#iii-인스턴스에-접속" title="Direct link to heading">#</a></h4><p>VS Code에서 <code>F1</code> -&gt; <code>Remote-SSH: Connect to Host</code> -&gt; <code>Add New SSH Host...</code><br>
-&gt; ssh -i &quot;C:/Users/PC/.ssh/kdt.pem&quot; <a href="mailto:ubuntu@ec2-3-36-222-25.ap-northeast-2.compute.amazonaws.com" target="_blank" rel="noopener noreferrer">ubuntu@ec2-3-36-222-25.ap-northeast-2.compute.amazonaws.com</a> 입력<br>
-&gt; <code>Connect</code> -&gt; <code>Linux</code></p><p>❗ <code>ssh -i ~</code> 명령에 .pem 파일의 경로를 입력할 때, Window에서는 무조건 절대경로를 써줘야 한다!</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="iv-터미널에서-환경-확인"></a>iv) 터미널에서 환경 확인<a class="hash-link" href="#iv-터미널에서-환경-확인" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1zKU"><div style="color:rgb(57, 58, 52);background-color:#e5ebf7" class="codeBlockTitle_2eSY">CPU 확인</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cmd codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:rgb(57, 58, 52);background-color:#e5ebf7"><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">$ lscpu</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div style="color:rgb(57, 58, 52);background-color:#e5ebf7" class="codeBlockTitle_2eSY">설치되어 있는 환경 확인</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cmd codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:rgb(57, 58, 52);background-color:#e5ebf7"><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">$ conda env list</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"># base, amazonei_mxnet_p36, aws_neuron_mxnet_p36,</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"># aws_neuron_pytorch_p36, aws_neuron_tensorflow_p36, mxnet_latest_p37, mxnet_p36,</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"># python3, pytorch_latest_p37, pytorch_p36, tensorflow2_latest_p37,</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"># tensorflow2_p36, tensorflow_p37      </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div style="color:rgb(57, 58, 52);background-color:#e5ebf7" class="codeBlockTitle_2eSY">가상환경을 실행하여 확인</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cmd codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:rgb(57, 58, 52);background-color:#e5ebf7"><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">$ conda activate pytorch_p36</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">$ python</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">&gt;&gt;&gt; import torch</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">&gt;&gt;&gt; torch.__version__</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">&gt;&gt;&gt; exit()</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="3-api-to-serve-ml-model"></a>3. API to serve ML model<a class="hash-link" href="#3-api-to-serve-ml-model" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="ml-모델을-서빙하는-api의-구조"></a>ML 모델을 서빙하는 API의 구조<a class="hash-link" href="#ml-모델을-서빙하는-api의-구조" title="Direct link to heading">#</a></h3><p>AWS EC2와 Python Flask를 기반으로 모델 학습 및 추론을 요청/응답하는 API 서버를 개발하는 것이 목표다.<br>
ㅤㅤ<img alt="func" src="/willbe/assets/images/aws5-f077f597b1b29ea4968b18a95bcc028b.jpg">  </p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="인터페이스-interface"></a>인터페이스 (Interface)<a class="hash-link" href="#인터페이스-interface" title="Direct link to heading">#</a></h4><p>사용자가 기계와 소프트웨어를 제어하기 위해 정해진 매뉴얼에 따라 사용하는 대상  </p><p>ex) 마우스, 키보드: 입력을 위한 인터페이스<br>
ㅤㅤ모니터, 프린터: 출력을 위한 인터페이스  </p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="api-application-programming-interface"></a>API (Application Programming Interface)<a class="hash-link" href="#api-application-programming-interface" title="Direct link to heading">#</a></h4><p>기계와 기계, 소프트웨어와 소프트웨어 간에 제어/커뮤니케이션하기 위한 인터페이스<br>
노드 간 데이터를 주고 받기 위한 인터페이스로, 마찬가지로 사전에 정해진 정의에 따라 입력이 들어왔을 때 적절한 출력을 전달해야 한다.  </p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="restful-api"></a>RESTful API<a class="hash-link" href="#restful-api" title="Direct link to heading">#</a></h3><p>REST 아키텍처를 따르는 API로, HTTP URI를 통해 자원을 명시하고 HTTP Method를 통해 필요한 연산을 요청/반환하는 API를 말한다. (<a href="/willbe/docs/kdt/web/flask1#3-flask-with-rest-api">이전에 정리한 내용</a>)  </p><p>RESTful API는 요청 메시지만 봐도 어떤 내용인지 알아볼 수 있도록 표현된다.  </p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="ml의-실제-프로세스"></a>ML의 실제 프로세스<a class="hash-link" href="#ml의-실제-프로세스" title="Direct link to heading">#</a></h3><p>ㅤㅤ<img alt="func" src="/willbe/assets/images/aws6-355c21a64572b33f29e1314f4012bcbd.jpg">  </p><p>문제 정의: raw data와 문제를 정의<br>
데이터 준비: 데이터 가공, Feature Engineering, 모델 학습 및 검증을 통해 배포해도 될 모델인지 판단<br>
배포: 모델 파일 배포를 위한 API 서버 제공 및 지속적으로 모델 성능 모니터링, 다양한 애플리케이션에 제공</p><p>우리는 실습을 통해 저장된 모델을 불러와서 예측하는 API 서버를 만든다.  </p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="model-serving"></a>Model Serving<a class="hash-link" href="#model-serving" title="Direct link to heading">#</a></h3><p>학습된 모델을 REST API 방식으로 배포하기 위해 학습된 모델의 Serialization과 웹 프레임워크를 통한 배포 준비가 필요하다.  </p><p>Model Training: 데이터 전처리, 모델 적합, 평가<br>
Serializing Model: 훈련된 모델 저장<br>
Serving Model: 모델 로드, 추론을 위한 핸들러 정의, 배포  </p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="serialization--de-serialization"></a>Serialization &amp; De-serialization<a class="hash-link" href="#serialization--de-serialization" title="Direct link to heading">#</a></h3><p>학습한 모델을 재사용하고 배포하기 위해 저장하고 불러오는 것  </p><p>Serialization을 통해 ML/DL 모델 객체를 디스크에 write하여 어디든 전송하고 불러올 수 있는 형태로 변환하고,<br>
De-serialization을 통해 파이썬 혹은 다른 환경에서 모델을 불러와 추론/학습에 사용한다.<br>
이 과정에서 모델을 배포하는 환경을 고려하여 환경에 맞는 올바른 방법으로 Serialization해야 De-serialization이 가능하다.  </p><p>Serialization과 De-serialization은 방식이 동일해야 한다. 예를 들어, joblib 라이브러리로 Serialization하고, pickle로 Ed-serialization을 하려고 한다면 제대로 작업을 수행할 수 없다.  </p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="모델-서빙을-위한-핸들러-구조"></a>모델 서빙을 위한 핸들러 구조<a class="hash-link" href="#모델-서빙을-위한-핸들러-구조" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-python codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(57, 58, 52);background-color:#e5ebf7"><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token keyword" style="color:rgb(0, 0, 159)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(0, 0, 159)">ModelHandler</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">BaseHandler</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 159)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">__init__</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 159)">pass</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 159)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">initialize</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 159)">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 159)">pass</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 159)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">preprocess</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 159)">pass</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 159)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">inference</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 159)">pass</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 159)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">postprocess</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 159)">pass</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">        </span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 159)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">handle</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 159)">pass</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="모델-서빙을-위한-다양한-프레임워크"></a>모델 서빙을 위한 다양한 프레임워크<a class="hash-link" href="#모델-서빙을-위한-다양한-프레임워크" title="Direct link to heading">#</a></h3><p>딥러닝 모델의 안정적인 서빙을 위해 일반적으로 TensorFlow serving, TorchServe, TensorRT와 같은 프레임워크를 사용한다.  </p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="4-실습-serialization--de-serialization"></a>4. 실습: Serialization &amp; De-serialization<a class="hash-link" href="#4-실습-serialization--de-serialization" title="Direct link to heading">#</a></h2><p>훈련 모델을 저장하고 다시 로드하는 작업을 실습한다.  </p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="실습-환경-세팅"></a>실습 환경 세팅<a class="hash-link" href="#실습-환경-세팅" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div style="color:rgb(57, 58, 52);background-color:#e5ebf7" class="codeBlockTitle_2eSY">아나콘다 가상환경 실행</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cmd codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:rgb(57, 58, 52);background-color:#e5ebf7"><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">$ conda activate pytorch_p36</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div style="color:rgb(57, 58, 52);background-color:#e5ebf7" class="codeBlockTitle_2eSY">템플릿 소스코드 다운로드</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cmd codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:rgb(57, 58, 52);background-color:#e5ebf7"><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">$ git clone https://github.com/sackoh/kdt-ai-aws</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">$ cd  kdt-ai-aws</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div style="color:rgb(57, 58, 52);background-color:#e5ebf7" class="codeBlockTitle_2eSY">필요 라이브러리 설치</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cmd codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:rgb(57, 58, 52);background-color:#e5ebf7"><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">$ pip install -r requirements.txt</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>❗ torch==1.6은 설치 시 접속이 자꾸 끊겨서 torch==1.8.1로 변경했다.  </p><p>❗ 파이썬 버전 바꾸기: <code>ls /usr/bin | grep python</code> -&gt; <code>udo update-alternatives --install /usr/bin/python python /usr/bin/python2.7 1</code> -&gt; <code>sudo update-alternatives --install /usr/bin/python python /usr/bin/python3.6 2</code> -&gt;<code>sudo update-alternatives --config python 2</code></p><p>❗ EC2 인스턴스 유형 변경: 인스턴트 <code>중지</code> -&gt; 인스턴트 우클릭 -&gt; <code>인스턴스 설정</code> -&gt; <code>인스턴스 유형 변경</code>에서 원하는 유형으로 변경 -&gt; 인스턴트 <code>시작</code></p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="머신러닝-모델-학습"></a>머신러닝 모델 학습<a class="hash-link" href="#머신러닝-모델-학습" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div style="color:rgb(57, 58, 52);background-color:#e5ebf7" class="codeBlockTitle_2eSY">모델 학습</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cmd codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:rgb(57, 58, 52);background-color:#e5ebf7"><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">$ python train_ml.py</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>ㅤㅤ<img alt="func" src="/willbe/assets/images/aws7-7847b1c970013d1ab1ee36223f92eafa.png">  </p><p>ratings_train.txt, ratings_test.txt를 다운, Vectorization 및 Feature Engineering, Naive Bayes 모델 학습, 정확도 계산, 전처리기와 모델 저장 과정을 확인할 수 있음  </p><div class="mdxCodeBlock_1zKU"><div style="color:rgb(57, 58, 52);background-color:#e5ebf7" class="codeBlockTitle_2eSY">De-serialization</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-python codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:rgb(57, 58, 52);background-color:#e5ebf7"><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token operator" style="color:rgb(0, 0, 159)">&gt;&gt;</span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 159)">import</span><span class="token plain"> joblib</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;&gt;</span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;</span><span class="token plain"> model </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> joblib</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">load</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(227, 17, 108)">&#x27;model/ml_model.pkl&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;&gt;</span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;</span><span class="token plain"> model</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token comment" style="color:rgb(153, 153, 136);font-style:italic"># MultinomialNB()</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;&gt;</span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;</span><span class="token plain"> vectorizer </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> joblib</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">load</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(227, 17, 108)">&#x27;model/ml_vectorizer.pkl&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;&gt;</span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;</span><span class="token plain"> vectorizer</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token comment" style="color:rgb(153, 153, 136);font-style:italic"># CountVectorizer(max_features=100000)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Vectorizer: 단어를 음절 단위로 쪼개고, 문장 내에서 각 음절이 몇번 반복되었는지 카운팅하여 벡터 형태로 표현한 전처리기 </p><div class="mdxCodeBlock_1zKU"><div style="color:rgb(57, 58, 52);background-color:#e5ebf7" class="codeBlockTitle_2eSY">text 감성분석 예제</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-python codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:rgb(57, 58, 52);background-color:#e5ebf7"><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token operator" style="color:rgb(0, 0, 159)">&gt;&gt;</span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;</span><span class="token plain"> text </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(227, 17, 108)">&quot;재미있는 영화입니다.&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token comment" style="color:rgb(153, 153, 136);font-style:italic"># Vectorization</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;&gt;</span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;</span><span class="token plain"> model_input </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> vectorizer</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">transform</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">text</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;&gt;</span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;</span><span class="token plain"> model_input</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token comment" style="color:rgb(153, 153, 136);font-style:italic"># &lt;1x100000 sparse matrix of type &#x27;&lt;class &#x27;numpy.int64&#x27;&gt;&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token comment" style="color:rgb(153, 153, 136);font-style:italic">#         with 2 stored elements in Compressed Sparse Row format&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token comment" style="color:rgb(153, 153, 136);font-style:italic"># 모델 input이 10만개의 컬럼을 가지고 있는 sparce한 매트릭스 형태로 저장됨</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;&gt;</span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 159)">print</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">model_input</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">asformat</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(227, 17, 108)">&#x27;array&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token comment" style="color:rgb(153, 153, 136);font-style:italic"># [[0 0 0 ... 0 0 0]]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token comment" style="color:rgb(153, 153, 136);font-style:italic"># Model 실행</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;&gt;</span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;</span><span class="token plain"> model_output </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> model</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">predict_proba</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">model_input</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;&gt;</span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;</span><span class="token plain"> model_output</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token comment" style="color:rgb(153, 153, 136);font-style:italic"># array([[0.02610797, 0.97389203]])  # 각각 0과 1에 속할 확률</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token comment" style="color:rgb(153, 153, 136);font-style:italic"># 레이블을 통해 사람이 이해할 수 있는 형태로 후처리</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;&gt;</span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;</span><span class="token plain"> model_output </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> model_output</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">argmax</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">axis</span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token number" style="color:rgb(54, 172, 170)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(153, 153, 136);font-style:italic"># 더 큰 값이 있는 인덱스 추출</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;&gt;</span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;</span><span class="token plain"> model_output</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token comment" style="color:rgb(153, 153, 136);font-style:italic"># array([1])</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;&gt;</span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;</span><span class="token plain"> id2label </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token number" style="color:rgb(54, 172, 170)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(227, 17, 108)">&#x27;negative&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(54, 172, 170)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token string" style="color:rgb(227, 17, 108)">&#x27;positive&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;&gt;</span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;</span><span class="token plain"> id2label</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token comment" style="color:rgb(153, 153, 136);font-style:italic"># {0: &#x27;negative&#x27;, 1: &#x27;positive&#x27;}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;&gt;</span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 159)">print</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string-interpolation string" style="color:rgb(227, 17, 108)">f&#x27;sentiment: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string-interpolation interpolation">id2label</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token string-interpolation interpolation">model_output</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token string-interpolation interpolation number" style="color:rgb(54, 172, 170)">0</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token string-interpolation string" style="color:rgb(227, 17, 108)">&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token comment" style="color:rgb(153, 153, 136);font-style:italic"># sentiment: positive</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="5-실습-예측을-수행하는-model-handler-개발"></a>5. 실습: 예측을 수행하는 model handler 개발<a class="hash-link" href="#5-실습-예측을-수행하는-model-handler-개발" title="Direct link to heading">#</a></h2><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="handle"></a>Handle<a class="hash-link" href="#handle" title="Direct link to heading">#</a></h4><p>요청 정보를 받아 적절한 응답을 반환한다.<br>
정의된 양식으로 데이터가 입력됐는지 확인 -&gt; 입력 값에 대한 전처리 및 모델에 입력하기 위한 형태로 변환 -&gt; 모델 추론 -&gt; 모델 반환값의 후처리 작업 -&gt; 결과 반환  </p><div class="mdxCodeBlock_1zKU"><div style="color:rgb(57, 58, 52);background-color:#e5ebf7" class="codeBlockTitle_2eSY">model.py</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-python codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:rgb(57, 58, 52);background-color:#e5ebf7"><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token keyword" style="color:rgb(0, 0, 159)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">handle</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    model_input </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">preprocess</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    model_output </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">inference</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">model_input</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 159)">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">postprocess</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">model_output</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="initailization"></a>Initailization<a class="hash-link" href="#initailization" title="Direct link to heading">#</a></h4><p>데이터 처리나 모델, configuration 등 초기화<br>
Configuration 등 초기화 -&gt; (옵션) 신경망을 구성하고 초기화 -&gt; 사전 학습한 모델이나 전처리기 불러오기 (De-serialization) </p><div class="mdxCodeBlock_1zKU"><div style="color:rgb(57, 58, 52);background-color:#e5ebf7" class="codeBlockTitle_2eSY">model.py</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-python codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:rgb(57, 58, 52);background-color:#e5ebf7"><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token keyword" style="color:rgb(0, 0, 159)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">initialize</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    </span><span class="token comment" style="color:rgb(153, 153, 136);font-style:italic"># De-serializing model and loading vectorizer</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 159)">import</span><span class="token plain"> joblib</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">model </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> joblib</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">load</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(227, 17, 108)">&#x27;model/ml_model.pkl&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">vectorizer </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> joblib</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">load</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(227, 17, 108)">&#x27;model/ml_vectorizer.pkl&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 159)">pass</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="preprocess"></a>Preprocess<a class="hash-link" href="#preprocess" title="Direct link to heading">#</a></h4><p>raw input 전처리 (scaling 등) -&gt; 모델에 입력 가능한 형태로 변환 (vectorization, converting to id 등)  </p><div class="mdxCodeBlock_1zKU"><div style="color:rgb(57, 58, 52);background-color:#e5ebf7" class="codeBlockTitle_2eSY">model.py</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-python codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:rgb(57, 58, 52);background-color:#e5ebf7"><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token keyword" style="color:rgb(0, 0, 159)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">preprocess</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> text</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    </span><span class="token comment" style="color:rgb(153, 153, 136);font-style:italic"># cleansing raw text</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    model_input </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">_clean_text</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">text</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    </span><span class="token comment" style="color:rgb(153, 153, 136);font-style:italic"># vectorizing cleaned text</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    model_input </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">vectorizer</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">transform</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">model_input</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 159)">return</span><span class="token plain"> model_input</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="inference"></a>Inference<a class="hash-link" href="#inference" title="Direct link to heading">#</a></h4><p>입력된 값에 대한 예측/추론<br>
각 모델의 predict 방식으로 예측 확률분포 값 반환  </p><div class="mdxCodeBlock_1zKU"><div style="color:rgb(57, 58, 52);background-color:#e5ebf7" class="codeBlockTitle_2eSY">model.py</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-python codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:rgb(57, 58, 52);background-color:#e5ebf7"><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token keyword" style="color:rgb(0, 0, 159)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">inference</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> model_input</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    </span><span class="token comment" style="color:rgb(153, 153, 136);font-style:italic"># get predictions from model as probabilities</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    model_output </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">model</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain">prob</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">model_input</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 159)">return</span><span class="token plain"> model_output</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="postprocess"></a>Postprocess<a class="hash-link" href="#postprocess" title="Direct link to heading">#</a></h4><p>모델의 예측값을 response에 맞게 후처리 작업<br>
일반적으로 모델은 확률분포와 같은 값을 반환하기 때문에 response에서 받아야 하는 정보로 처리하는 역할을 많이 한다.  </p><div class="mdxCodeBlock_1zKU"><div style="color:rgb(57, 58, 52);background-color:#e5ebf7" class="codeBlockTitle_2eSY">model.py</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-python codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:rgb(57, 58, 52);background-color:#e5ebf7"><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token keyword" style="color:rgb(0, 0, 159)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">postprocess</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> model_output</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    </span><span class="token comment" style="color:rgb(153, 153, 136);font-style:italic"># process predictions to predicted label and output format</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    predicted_probabilities </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> model_output</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token builtin" style="color:rgb(227, 17, 108)">max</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">axis</span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token number" style="color:rgb(54, 172, 170)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    predicted_ids </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> model_output</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">argmax</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">axis</span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token number" style="color:rgb(54, 172, 170)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    predicted_labels </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">id2label</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">id_</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 159)">for</span><span class="token plain"> id_ </span><span class="token keyword" style="color:rgb(0, 0, 159)">in</span><span class="token plain"> predicted_ids</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 159)">return</span><span class="token plain"> predicted_labels</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> predicted_probabilities</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="testing-ml-model-handler"></a>Testing ML model handler<a class="hash-link" href="#testing-ml-model-handler" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-python codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(57, 58, 52);background-color:#e5ebf7"><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token operator" style="color:rgb(0, 0, 159)">&gt;&gt;</span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 159)">from</span><span class="token plain"> model </span><span class="token keyword" style="color:rgb(0, 0, 159)">import</span><span class="token plain"> MLModelHandler</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;&gt;</span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;</span><span class="token plain"> ml_handler </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> MLModelHandler</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;&gt;</span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(227, 17, 108)">dir</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">ml_handler</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token comment" style="color:rgb(153, 153, 136);font-style:italic"># [&#x27;__class__&#x27;, &#x27;__delattr__&#x27;, &#x27;__dict__&#x27;, &#x27;__dir__&#x27;, &#x27;__doc__&#x27;, &#x27;__eq__&#x27;, &#x27;__format__&#x27;, &#x27;__ge__&#x27;,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token comment" style="color:rgb(153, 153, 136);font-style:italic"># &#x27;__getattribute__&#x27;, &#x27;__gt__&#x27;, &#x27;__hash__&#x27;, &#x27;__init__&#x27;, &#x27;__init_subclass__&#x27;, &#x27;__le__&#x27;, &#x27;__lt__&#x27;,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token comment" style="color:rgb(153, 153, 136);font-style:italic"># &#x27;__module__&#x27;, &#x27;__ne__&#x27;, &#x27;__new__&#x27;, &#x27;__reduce__&#x27;, &#x27;__reduce_ex__&#x27;, &#x27;__repr__&#x27;, &#x27;__setattr__&#x27;,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token comment" style="color:rgb(153, 153, 136);font-style:italic"># &#x27;__sizeof__&#x27;, &#x27;__str__&#x27;, &#x27;__subclasshook__&#x27;, &#x27;__weakref__&#x27;, &#x27;_clean_text&#x27;, &#x27;handle&#x27;,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token comment" style="color:rgb(153, 153, 136);font-style:italic"># &#x27;id2label&#x27;, &#x27;inference&#x27;, &#x27;initialize&#x27;, &#x27;model&#x27;, &#x27;postprocess&#x27;, &#x27;preprocess&#x27;, &#x27;vectorizer&#x27;]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;&gt;</span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;</span><span class="token plain"> ml_handler</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">vectorizer</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token comment" style="color:rgb(153, 153, 136);font-style:italic"># CountVectorizer(max_features=100000)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;&gt;</span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;</span><span class="token plain"> text </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token string" style="color:rgb(227, 17, 108)">&#x27;정말 재미있는 영화입니다.&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(227, 17, 108)">&#x27;정말 재미가 없습니다.&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;&gt;</span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;</span><span class="token plain"> result </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> ml_handler</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">handle</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">text</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;&gt;</span><span class="token operator" style="color:rgb(0, 0, 159)">&gt;</span><span class="token plain"> result</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token comment" style="color:rgb(153, 153, 136);font-style:italic"># ([&#x27;positive&#x27;, &#x27;negative&#x27;], array([0.98689943, 0.79583852]))</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="6-flask-기반-감성분석-api-개발"></a>6. Flask 기반 감성분석 API 개발<a class="hash-link" href="#6-flask-기반-감성분석-api-개발" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="네이버-영화리뷰-감성분석-개요"></a>네이버 영화리뷰 감성분석 개요<a class="hash-link" href="#네이버-영화리뷰-감성분석-개요" title="Direct link to heading">#</a></h3><p>네이버 영화리뷰 데이터로 학습한 ML/DL 모델을 활용하여 감성분석 API를 개발한다.<br>
나이브베이지안 모델과 딥러닝 모델로 학습한 두 개의 모델을 서빙하며, 0은 부정, 1은 긍정을 의미한다.  </p><p>💡 학습에 사용한 데이터는 박은정님이 공개한 <a href="https://github.com/e9t/nsmc" target="_blank" rel="noopener noreferrer">NSMC(Naver Sentiment Movie Corpus) 데이터</a>다.  </p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="감성분석-api-개발-방향"></a>감성분석 API 개발 방향<a class="hash-link" href="#감성분석-api-개발-방향" title="Direct link to heading">#</a></h3><p>POST predict 요청 (영화 리뷰에 대한 텍스트) -&gt; do_fast 요청 정보에 따라 ML/DL 모델로 예측 -&gt; 감성분석 결과 반환 (text, label, confidence 리턴)  </p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="api-정의"></a>API 정의<a class="hash-link" href="#api-정의" title="Direct link to heading">#</a></h3><p>POST 방식으로 predict를 요청하게 되며, <code>do_fast</code>를 True로 할 경우 빠른 속도로 추론 가능한 머신러닝 모델로 추론하도록 하고, False로 할 경우 추론 속도는 비교적 느리지만 정확도가 높은 딥러닝 모델로 추론하도록 한다.  </p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="딥러닝-모델-핸들러-추가"></a>딥러닝 모델 핸들러 추가<a class="hash-link" href="#딥러닝-모델-핸들러-추가" title="Direct link to heading">#</a></h3><p>사전 학습한 딥러닝 모델을 활용하여 머신러닝 모델 handler와 동일한 입력에 대해 동일한 결과를 반환하는 hander를 개발한다.  </p><p>❗ 사전 학습한 모델은 <a href="https://huggingface.co/" target="_blank" rel="noopener noreferrer">Hugging Face</a>에서 제공하는 외부 저장소에서 다운로드 받는다.  </p><div class="mdxCodeBlock_1zKU"><div style="color:rgb(57, 58, 52);background-color:#e5ebf7" class="codeBlockTitle_2eSY">model.py</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-python codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:rgb(57, 58, 52);background-color:#e5ebf7"><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token keyword" style="color:rgb(0, 0, 159)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">initialize</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 159)">from</span><span class="token plain"> transformers </span><span class="token keyword" style="color:rgb(0, 0, 159)">import</span><span class="token plain"> AutoTokenizer</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> AutoModelForSequenceClassification</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">model_name_or_path </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(227, 17, 108)">&#x27;sackoh/bert-base-multilinqual-cased-nsmc&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">tokenizer </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> AutoTokenizer</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">from_pretrained</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">model_name_or_path</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">model </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> AutoModelForSequenceClassification</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">from_pretrained</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">model_name_or_path</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">model</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">to</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(227, 17, 108)">&#x27;cpu&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 159)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">preprocess</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> text</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    model_input </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">_clean_text</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">text</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    model_input </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">tokenizer</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">text</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> return_tensors</span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token string" style="color:rgb(227, 17, 108)">&#x27;pt&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> padding</span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token boolean" style="color:rgb(188, 84, 84)">True</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 159)">return</span><span class="token plain"> model_input</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 159)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">inference</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> model_input</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 159)">with</span><span class="token plain"> torch</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">no_grad</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">        model_output </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">model</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(0, 0, 159)">**</span><span class="token plain">model_input</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token number" style="color:rgb(54, 172, 170)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">cpu</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">        model_output </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(54, 172, 170)">1.0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 159)">/</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(54, 172, 170)">1.0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 159)">+</span><span class="token plain"> torch</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">exp</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(0, 0, 159)">-</span><span class="token plain">model_output</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">        model_output </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> model_output</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">numpy</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">astype</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(227, 17, 108)">&#x27;float&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 159)">return</span><span class="token plain"> model_output</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 159)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">postprocess</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> model_output</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    predicted_probabilities </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> model_output</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token builtin" style="color:rgb(227, 17, 108)">max</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">axis</span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token number" style="color:rgb(54, 172, 170)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    predicted_ids </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> model_output</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">argmax</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">axis</span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token number" style="color:rgb(54, 172, 170)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    predicted_labels </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">id2label</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">id_</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 159)">for</span><span class="token plain"> id_ </span><span class="token keyword" style="color:rgb(0, 0, 159)">in</span><span class="token plain"> predicted_ids</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 159)">return</span><span class="token plain"> predicted_labels</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> predicted_probabilities</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 159)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">handle</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    model_input </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">preprocess</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    model_output </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">inference</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">model_input</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 159)">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">postprocess</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">model_output</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="unittest"></a>Unittest<a class="hash-link" href="#unittest" title="Direct link to heading">#</a></h3><p>앞에서는 코드를 한 줄씩 치면서 테스트를 진행했지만, 일반적으로는 파일을 생성하여 테스트를 진행한다.  </p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cmd codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(57, 58, 52);background-color:#e5ebf7"><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">$ python -m unittest -v test_model_handler.py</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>❗ ImportError: cannot import name &#x27;SAVE_STATE_WARNING&#x27; 오류 발생<br>
-&gt; <code>pip install -U transformers</code></p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="flask-api-개발--배포"></a>Flask API 개발 &amp; 배포<a class="hash-link" href="#flask-api-개발--배포" title="Direct link to heading">#</a></h3><p>model을 전역변수로 불러오고, 요청된 텍스트에 대해 예측 결과를 반환하는 코드를 입력한다.  </p><div class="mdxCodeBlock_1zKU"><div style="color:rgb(57, 58, 52);background-color:#e5ebf7" class="codeBlockTitle_2eSY">app.py</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-python codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:rgb(57, 58, 52);background-color:#e5ebf7"><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token keyword" style="color:rgb(0, 0, 159)">from</span><span class="token plain"> flask </span><span class="token keyword" style="color:rgb(0, 0, 159)">import</span><span class="token plain"> Flask</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> json</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 159)">from</span><span class="token plain"> model </span><span class="token keyword" style="color:rgb(0, 0, 159)">import</span><span class="token plain"> MLModelHandler</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> DLModelHandler</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">app </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> Flask</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">__name__</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">ml_handler </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> MLModelHandler</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">dl_handler </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> DLModelHandler</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:rgb(153, 76, 195)">@app</span><span class="token decorator annotation punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token decorator annotation punctuation" style="color:rgb(153, 76, 195)">route</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(227, 17, 108)">&quot;/predict&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> methods</span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token string" style="color:rgb(227, 17, 108)">&quot;POST&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 159)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">predict</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    </span><span class="token comment" style="color:rgb(153, 153, 136);font-style:italic"># handle request and body</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    body </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">get_json</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    text </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> body</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(227, 17, 108)">&#x27;text&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(227, 17, 108)">&#x27;&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    text </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">text</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 159)">if</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(227, 17, 108)">isinstance</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">text</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(227, 17, 108)">str</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 159)">else</span><span class="token plain"> text</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    do_fast </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> body</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(227, 17, 108)">&#x27;do_fast&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">True</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 159)">if</span><span class="token plain"> do_fast</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">        predictions </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> ml_handler</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">handle</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">text</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 159)">else</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">        predictions </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> dl_handler</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">handle</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">text</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    </span><span class="token comment" style="color:rgb(153, 153, 136);font-style:italic"># response</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    result </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> json</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">dumps</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token builtin" style="color:rgb(227, 17, 108)">str</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(227, 17, 108)">&#x27;text&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(227, 17, 108)">&#x27;label&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> l</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(227, 17, 108)">&#x27;confidence&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">                         </span><span class="token keyword" style="color:rgb(0, 0, 159)">for</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">t</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> l</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 159)">in</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(227, 17, 108)">enumerate</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token builtin" style="color:rgb(227, 17, 108)">zip</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">text</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> predictions</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token number" style="color:rgb(54, 172, 170)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> predictions</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token number" style="color:rgb(54, 172, 170)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 159)">return</span><span class="token plain"> result</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 159)">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:rgb(0, 0, 159)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(227, 17, 108)">&quot;__main__&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">    app</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">host</span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token string" style="color:rgb(227, 17, 108)">&#x27;0.0.0.0&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> port</span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token string" style="color:rgb(227, 17, 108)">&#x27;5000&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> debug</span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token boolean" style="color:rgb(188, 84, 84)">True</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="test-api-on-remote"></a>Test API on remote<a class="hash-link" href="#test-api-on-remote" title="Direct link to heading">#</a></h3><p>host: EC2 인스턴스 생성 시에 받은 퍼블릭 IP 주소 또는 직접 할당한 탄력적 IP 주소
port: EC2 인스턴스 생성 시에 설정했던 port 번호</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cmd codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(57, 58, 52);background-color:#e5ebf7"><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">$ python app.py</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>ㅤㅤ<img alt="func" src="/willbe/assets/images/aws8-f1cbb22e9ff917285143e70e627b5714.png">  </p><p>❗ 오류가 나는데.. 아직 해결을 못하겠다..  </p><div class="mdxCodeBlock_1zKU"><div style="color:rgb(57, 58, 52);background-color:#e5ebf7" class="codeBlockTitle_2eSY">로컬 터미널 이용</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cmd codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:rgb(57, 58, 52);background-color:#e5ebf7"><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">curl -d &#x27;{&quot;text&quot;: [&quot;영화 오랜만에 봤는데 괜찮은 영화였어&quot;, &quot;정말 지루했어&quot;], &quot;use_fast&quot;: false}&#x27; -H &quot;Content-Type: application/json; charset=utf-8&quot; -X POST http://3.36.222.25:5000/predict</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div style="color:rgb(57, 58, 52);background-color:#e5ebf7" class="codeBlockTitle_2eSY">로컬 파이썬 이용</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-python codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:rgb(57, 58, 52);background-color:#e5ebf7"><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token keyword" style="color:rgb(0, 0, 159)">import</span><span class="token plain"> requests</span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">url </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(227, 17, 108)">&#x27;http://3.36.222.25:5000/predict&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">data </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(227, 17, 108)">&#x27;text&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token string" style="color:rgb(227, 17, 108)">&#x27;영화 오랜만에 봤는데 정말 재미있었어&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(227, 17, 108)">&#x27;영화가 정말 지루했었어&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">        </span><span class="token string" style="color:rgb(227, 17, 108)">&#x27;use_fast&#x27;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token boolean" style="color:rgb(188, 84, 84)">False</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain">response </span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">post</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">url</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> json</span><span class="token operator" style="color:rgb(0, 0, 159)">=</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 159)">print</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">response</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">content</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(57, 58, 52)"><span class="token plain"></span><span class="token comment" style="color:rgb(153, 153, 136);font-style:italic"># b&#x27;{&quot;0&quot;: {&quot;confidence&quot;: 0.9493448650307134, &quot;label&quot;: &quot;positive&quot;, &quot;text&quot;: &quot;\\uc601\\ud654 \\uc624\\ub79c\\ub9cc\\uc5d0 \\ubd24\\ub294\\ub370 \\uc815\\ub9d0 \\uc7ac\\ubbf8\\uc788\\uc5c8\\uc5b4&quot;}, &quot;1&quot;: {&quot;confidence&quot;: 0.6462474236448803, &quot;label&quot;: &quot;positive&quot;, &quot;text&quot;: &quot;\\uc601\\ud654\\uac00 \\uc815\\ub9d0 \\uc9c0\\ub8e8\\ud588\\uc5c8\\uc5b4&quot;}}&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="-mission"></a>+ Mission<a class="hash-link" href="#-mission" title="Direct link to heading">#</a></h2><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="train-api-추가"></a>Train API 추가<a class="hash-link" href="#train-api-추가" title="Direct link to heading">#</a></h4><p>Serialization 실습에서 실행했던 train_ml.py를 참조하여 <code>http://host:port/train</code> 모델 학습을 요청하는 API를 추가합니다.  </p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/willbe/docs/kdt/web/flask1"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Flask</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/willbe/docs/kdt/web/django1"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">django를 활용하여 웹 사이트 만들기 »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-클라우드-기초" class="table-of-contents__link">1. 클라우드 기초</a><ul><li><a href="#클라우드-컴퓨팅-등장-이전" class="table-of-contents__link">클라우드 컴퓨팅 등장 이전</a></li><li><a href="#클라우드-컴퓨팅-등장-배경" class="table-of-contents__link">클라우드 컴퓨팅 등장 배경</a></li><li><a href="#클라우드-컴퓨팅-cloud-computing" class="table-of-contents__link">클라우드 컴퓨팅 (Cloud Computing)</a></li><li><a href="#클라우드-컴퓨팅의-장점" class="table-of-contents__link">클라우드 컴퓨팅의 장점</a></li><li><a href="#클라우드-컴퓨팅-운용-모델" class="table-of-contents__link">클라우드 컴퓨팅 운용 모델</a></li><li><a href="#클라우드-서비스-제공-모델" class="table-of-contents__link">클라우드 서비스 제공 모델</a></li><li><a href="#aws-cloud-computing" class="table-of-contents__link">AWS Cloud Computing</a></li></ul></li><li><a href="#2-실습-aws--실습-환경-세팅" class="table-of-contents__link">2. 실습: AWS &amp; 실습 환경 세팅</a><ul><li><a href="#aws-계정-가입" class="table-of-contents__link">AWS 계정 가입</a></li><li><a href="#ec2-생성--security-group-설정" class="table-of-contents__link">EC2 생성 &amp; Security Group 설정</a></li><li><a href="#탄력적-ip-설정" class="table-of-contents__link">탄력적 IP 설정</a></li><li><a href="#vs-code로-환경-테스트" class="table-of-contents__link">VS Code로 환경 테스트</a></li></ul></li><li><a href="#3-api-to-serve-ml-model" class="table-of-contents__link">3. API to serve ML model</a><ul><li><a href="#ml-모델을-서빙하는-api의-구조" class="table-of-contents__link">ML 모델을 서빙하는 API의 구조</a></li><li><a href="#restful-api" class="table-of-contents__link">RESTful API</a></li><li><a href="#ml의-실제-프로세스" class="table-of-contents__link">ML의 실제 프로세스</a></li><li><a href="#model-serving" class="table-of-contents__link">Model Serving</a></li><li><a href="#serialization--de-serialization" class="table-of-contents__link">Serialization &amp; De-serialization</a></li><li><a href="#모델-서빙을-위한-핸들러-구조" class="table-of-contents__link">모델 서빙을 위한 핸들러 구조</a></li><li><a href="#모델-서빙을-위한-다양한-프레임워크" class="table-of-contents__link">모델 서빙을 위한 다양한 프레임워크</a></li></ul></li><li><a href="#4-실습-serialization--de-serialization" class="table-of-contents__link">4. 실습: Serialization &amp; De-serialization</a><ul><li><a href="#실습-환경-세팅" class="table-of-contents__link">실습 환경 세팅</a></li><li><a href="#머신러닝-모델-학습" class="table-of-contents__link">머신러닝 모델 학습</a></li></ul></li><li><a href="#5-실습-예측을-수행하는-model-handler-개발" class="table-of-contents__link">5. 실습: 예측을 수행하는 model handler 개발</a></li><li><a href="#6-flask-기반-감성분석-api-개발" class="table-of-contents__link">6. Flask 기반 감성분석 API 개발</a><ul><li><a href="#네이버-영화리뷰-감성분석-개요" class="table-of-contents__link">네이버 영화리뷰 감성분석 개요</a></li><li><a href="#감성분석-api-개발-방향" class="table-of-contents__link">감성분석 API 개발 방향</a></li><li><a href="#api-정의" class="table-of-contents__link">API 정의</a></li><li><a href="#딥러닝-모델-핸들러-추가" class="table-of-contents__link">딥러닝 모델 핸들러 추가</a></li><li><a href="#unittest" class="table-of-contents__link">Unittest</a></li><li><a href="#flask-api-개발--배포" class="table-of-contents__link">Flask API 개발 &amp; 배포</a></li><li><a href="#test-api-on-remote" class="table-of-contents__link">Test API on remote</a></li></ul></li><li><a href="#-mission" class="table-of-contents__link">+ Mission</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 HEEJU LEE</div></div></div></footer></div>
<script src="/willbe/styles.2c3dfb8e.js"></script>
<script src="/willbe/runtime~main.8bbf9e40.js"></script>
<script src="/willbe/main.d215830a.js"></script>
<script src="/willbe/1.95d38675.js"></script>
<script src="/willbe/2.1bb1b4fc.js"></script>
<script src="/willbe/1be78505.23bb998b.js"></script>
<script src="/willbe/104.1ff1ac5b.js"></script>
<script src="/willbe/f976f453.087a1e6b.js"></script>
<script src="/willbe/103.9c5787d0.js"></script>
<script src="/willbe/616f799a.bde1250b.js"></script>
</body>
</html>